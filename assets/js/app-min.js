const drawGridWrapper=document.querySelector("#draw-grid"),drawGrid=drawGridWrapper.querySelector(".grid"),generateCluesBtn=document.querySelector("#generate-clues");let clueSubGrid,solutionSubGrid;const modal=document.querySelector(".modal--puzzle"),clueGrid=modal.querySelector("#clue-grid"),solutionGrid=modal.querySelector("#solution-grid"),solutionBtn=modal.querySelector("#view-solution"),printBtn=modal.querySelector("#print-puzzle"),closeBtn=modal.querySelector(".close"),helpModal=document.querySelector(".modal--help"),helpCloseBtn=helpModal.querySelector(".close");function generateBlankPuzzle(){const e=document.querySelectorAll(".intro input"),t=document.querySelector("#puzzle-width").value,l=document.querySelector("#puzzle-height").value;verifyInput(t)&&verifyInput(l)?(e.forEach((function(e){e.classList.remove("error")})),clearAllGrids(),generateDrawGrid(t,l),generateClueSubGrid(),initializeDrawGrid()):e.forEach((function(e){verifyInput(e.value)?e.classList.remove("error"):e.classList.add("error")}))}function generateDrawGrid(e,t){drawGrid.classList.add("grid"),drawGrid.style.width=3*e+.5+"rem",drawGrid.style.gridTemplateColumns=`repeat(${e}, 3rem)`,drawGrid.style.gridTemplateRows=`repeat(${t}, 3rem)`,drawGrid.setAttribute("data-columns",e),drawGrid.setAttribute("data-rows",t);let l=[];for(let r=0;r<e*t;r++)l.push("<div></div>");drawGrid.innerHTML=l.join("")}function initializeDrawGrid(){drawGridWrapper.style.display="flex"}function generateClueSubGrid(){clueSubGrid=drawGrid.cloneNode(!0)}function generateSolutionSubGrid(){solutionSubGrid=drawGrid.cloneNode(!0)}function generateClueHTML(e,t){const l=Array.from(drawGrid.querySelectorAll("div")),r=e;let n=Array.from(Array(t),(()=>Array(e))),o=Array.from(Array(e),(()=>Array(t)));for(let e=0;e<l.length;e++){let t=Math.floor(e/r);n[t][e-t*r]=l[e].classList.contains("fill"),o[e-t*r][t]=l[e].classList.contains("fill")}const i=document.createElement("div");i.classList.add("clue"),i.style.gridTemplateColumns=`auto .25rem repeat(${e}, 3rem) .25rem`,i.style.gridTemplateRows=`auto .25rem repeat(${t}, 3rem) .25rem`,i.innerHTML=buildClues(n,o),modal.querySelector("h2").textContent=`Puzzle (${e}x${t})`,clueSubGrid.style.gridColumn="2 / span "+(e+2),clueSubGrid.style.gridRow="2 / span "+(t+2),placeSubGrids(e,t),buildClueGrid(i),buildSolutionGrid(i.cloneNode(!0),e,t),openModal()}function placeSubGrids(e,t){clueSubGrid.style.gridColumn="2 / span "+(e+2),clueSubGrid.style.gridRow="2 / span "+(t+2),solutionSubGrid.style.gridColumn="2 / span "+(e+2),solutionSubGrid.style.gridRow="2 / span "+(t+2)}function buildClueGrid(e){e.appendChild(clueSubGrid),clueGrid.append(e)}function buildSolutionGrid(e,t,l){solutionGrid.append(e),solutionGrid.querySelector(".clue").append(solutionSubGrid)}function clearAllGrids(){clearGrid(),clearClueGrid(),clearSolutionGrid()}document.querySelector("#generate-puzzle").addEventListener("click",generateBlankPuzzle),generateCluesBtn.addEventListener("click",(function(){clearClueGrid(),clearSolutionGrid(),generateSolutionSubGrid(),generateClueHTML(getGridColumns(),getGridRows())})),drawGrid.addEventListener("click",(function(e){e.target!==drawGrid&&e.target.classList.toggle("fill")}));const clearGrid=function(){drawGridWrapper.style.display="none",drawGrid.innerHTML=""},clearClueGrid=function(){clueGrid.innerHTML=""};function clearSolutionGrid(){solutionGrid.innerHTML=""}const buildClues=function(e,t){let l="";for(let t=0;t<e.length;t++)l+=`<span class="row" style="grid-column: 1; grid-row: ${t+3};">`+calculateClues(e,t)+"</span>";for(let e=0;e<t.length;e++)l+=`<span class="col" style="grid-column: ${e+3}; grid-row: 1;">`+calculateClues(t,e)+"</span>";return l};function calculateClues(e,t){let l="",r=0;for(let n=0;n<e[t].length;n++)e[t][n]?r++:r>0&&(l+=`<span>${r}</span>`,r=0),n===e[t].length-1&&r>0&&(l+=`<span>${r}</span>`);return""===l&&(l+="<span>0</span>"),l}function getGridColumns(){return parseInt(drawGrid.getAttribute("data-columns"))}function getGridRows(){return parseInt(drawGrid.getAttribute("data-rows"))}function openHelpModal(){helpModal.classList.contains("open")||(helpCloseBtn.addEventListener("click",closeHelpModal),window.addEventListener("keyup",handleKeyUp),helpModal.classList.add("open"))}function closeHelpModal(){helpModal.classList.contains("open")&&(helpModal.classList.remove("open"),helpCloseBtn.removeEventListener("click",closeHelpModal),window.removeEventListener("keyup",handleKeyUp))}function openModal(e){console.log(e),modal.classList.contains("open")||(solutionGrid.classList.add("hide"),printBtn.addEventListener("click",printPuzzle),solutionBtn.addEventListener("click",toggleSolution),closeBtn.addEventListener("click",closeModal),window.addEventListener("keyup",handleKeyUp),modal.classList.add("open"))}function closeModal(){modal.classList.contains("open")&&(modal.classList.remove("open"),printBtn.removeEventListener("click",printPuzzle),closeBtn.removeEventListener("click",closeModal),window.removeEventListener("keyup",handleKeyUp),solutionBtn.removeEventListener("click",toggleSolution))}function handleKeyUp(e){if("Escape"===e.key){if(modal.classList.contains("open"))return closeModal();if(helpModal.classList.contains("open"))return closeHelpModal()}}function printPuzzle(){window.print()}function toggleSolution(){solutionGrid.classList.contains("hide")?solutionBtn.textContent="Hide Solution":solutionBtn.textContent="View Solution",solutionGrid.classList.toggle("hide"),clueGrid.classList.toggle("hide")}function verifyInput(e){return parseInt(e)>0&&parseInt(e)<=25}document.querySelector("#help").addEventListener("click",openHelpModal);