const drawGridWrapper=document.querySelector("#draw-grid"),drawGrid=drawGridWrapper.querySelector(".grid"),clueGrid=document.querySelector("#clue-grid"),modal=document.querySelector(".modal__outer");let blankGrid;const generatePuzzleBtn=document.querySelector("#generate-puzzle"),generateCluesBtn=document.querySelector("#generate-clues"),solutionBtn=document.querySelector("#view-solution"),printBtn=document.querySelector("#print-puzzle"),closeBtn=modal.querySelector("#close");function generateBlankGrid(e,r){drawGrid.innerHTML="",drawGrid.className="grid",drawGrid.style.width=3*e+.5+"rem",drawGrid.style.gridTemplateColumns=`repeat(${e}, 3rem)`,drawGrid.style.gridTemplateRows=`repeat(${r}, 3rem)`,drawGrid.setAttribute("data-columns",e),drawGrid.setAttribute("data-rows",r);for(let t=0;t<e*r;t++)drawGrid.innerHTML+="<div></div>";blankGrid=drawGrid.cloneNode(!0),drawGridWrapper.style.display="flex",document.querySelector("#generate-button-wrapper").style.display="flex"}generatePuzzleBtn.addEventListener("click",(function(e){clearGrid(),clearClueGrid();generateBlankGrid(document.querySelector("#puzzle-width").value,document.querySelector("#puzzle-height").value)})),generateCluesBtn.addEventListener("click",(function(e){clearClueGrid(),buildClueGrid(getGridColumns(),getGridRows())}));const buildClueGrid=function(e,r){const t=Array.from(drawGrid.querySelectorAll("div")),l=e;let n=Array.from(Array(r),()=>Array(e)),d=Array.from(Array(e),()=>Array(r));for(let e=0;e<t.length;e++){let r=Math.floor(e/l);n[r][e-r*l]=t[e].classList.contains("fill"),d[e-r*l][r]=t[e].classList.contains("fill")}let a=buildClues(n,d);const i=document.createElement("div");i.classList.add("clue"),blankGrid.style.gridColumn="2 / span "+(e+2),blankGrid.style.gridRow="2 / span "+(r+2),i.style.gridTemplateColumns=`auto .25rem repeat(${e}, 3rem) .25rem`,i.style.gridTemplateRows=`auto .25rem repeat(${r}, 3rem) .25rem`,i.innerHTML=a,i.appendChild(blankGrid),document.querySelector("#clue-grid").append(i),modal.querySelector("h2").innerText=`Puzzle (${e}x${r})`,modal.classList.add("open")},clearGrid=function(){drawGridWrapper.style.display="none",document.querySelector("#generate-button-wrapper").style.display="none",drawGrid.innerHTML=""},clearClueGrid=function(){clueGrid.innerHTML=""},buildClues=function(e,r){let t="";for(let r=0;r<e.length;r++)t+=`<span class="row" style="grid-column: 1; grid-row: ${r+3};">`+calculateClues(e,r)+"</span>";for(let e=0;e<r.length;e++)t+=`<span class="col" style="grid-column: ${e+3}; grid-row: 1;">`+calculateClues(r,e)+"</span>";return t};function calculateClues(e,r){let t="",l=0;for(let n=0;n<e[r].length;n++)e[r][n]?l++:l>0&&(t+=`<span>${l}</span>`,l=0),n===e[r].length-1&&l>0&&(t+=`<span>${l}</span>`);return""===t&&(t+="<span>0</span>"),t}function getGridColumns(){return parseInt(drawGrid.getAttribute("data-columns"))}function getGridRows(){return parseInt(drawGrid.getAttribute("data-rows"))}function closeModal(){modal.classList.remove("open")}drawGrid.addEventListener("click",(function(e){e.target.classList.toggle("fill")})),closeBtn.addEventListener("click",closeModal),window.addEventListener("keyup",(function(e){"Escape"===e.key&&modal.classList.contains("open")&&closeModal()})),printBtn.addEventListener("click",(function(){window.print()})),solutionBtn.addEventListener("click",(function(){let e=drawGrid.cloneNode(!0);clueGrid.querySelector(".grid").innerHTML=e.innerHTML}));