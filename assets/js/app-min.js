const grid=document.querySelector("#grid .grid");grid.addEventListener("click",(function(e){e.target.classList.toggle("fill")})),document.querySelector("#generate").addEventListener("click",(function(e){clearPuzzle(),buildPuzzle(grid.classList[1]),e.preventDefault()}));const generateGrid=function(e){let t=e.split("x"),l=parseInt(t.shift()),r=parseInt(t.shift());grid.innerHTML="",grid.class="grid",grid.classList.add(e),grid.style.width=3*l+.5+"rem",grid.style.gridTemplateColumns=`repeat(${l}, 3rem)`,grid.style.gridTemplateRows=`repeat(${r}, 3rem)`;for(var n=0;n<l*r;n++)grid.innerHTML+="<div></div>"};generateGrid("7x5");const buildPuzzle=function(e){const t=Array.from(document.querySelectorAll("#grid .grid div"));let l=e.split("x"),r=parseInt(l.shift()),n=parseInt(l.shift()),s=r,i=[];for(let e=0;e<n;e++)i[e]=[];let a=[];for(let e=0;e<r;e++)a[e]=[];for(let e=0;e<t.length;e++){let l=Math.floor(e/s);i[l][e-l*s]=t[e].classList.contains("fill"),a[e-l*s][l]=t[e].classList.contains("fill")}let d=buildClues(i,a);const c=document.createElement("div");c.classList.add("clue");var o=grid.cloneNode(!0);o.removeAttribute("id"),o.style.gridColumn="2 / span "+(parseInt(r)+2),o.style.gridRow="2 / span "+(n+2),c.style.gridTemplateColumns=`auto .25rem repeat(${r}, 3rem) .25rem`,c.style.gridTemplateRows=`auto .25rem repeat(${n}, 3rem) .25rem`,c.innerHTML=d,c.appendChild(o),document.querySelector("#clue-grid").append(c)},clearPuzzle=function(){document.querySelector("#clue-grid").innerHTML=""},buildClues=function(e,t){let l="";for(let t=0;t<e.length;t++)l+=`<span class="row" style="grid-column: 1; grid-row: ${t+3};">`+calculateClues(e,t)+"</span>";for(let e=0;e<t.length;e++)l+=`<span class="col" style="grid-column: ${e+3}; grid-row: 1;">`+calculateClues(t,e)+"</span>";return l},calculateClues=function(e,t){let l="",r=0,n=[];for(let t=0;t<e.length;t++)n[t]=[];for(let s=0;s<e[t].length;s++)e[t][s]?r++:r>0&&(n[t].push(r),l+=`<span>${r}</span>`,r=0),s===e[t].length-1&&r>0&&(n[t].push(r),l+=`<span>${r}</span>`,r=0);return 0===n[t].length&&(l+=`<span>${r}</span>`),l};