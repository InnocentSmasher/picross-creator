const grid=document.querySelector("#grid .grid"),modal=document.querySelector(".modal__outer"),close=modal.querySelector(".close");document.querySelector("#generate-puzzle").addEventListener("click",(function(e){clearGrid(),clearPuzzle();const t=document.querySelector("#puzzle-width").value,l=document.querySelector("#puzzle-height").value;generateGrid(`${t}x${l}`)})),document.querySelector("#generate-clues").addEventListener("click",(function(e){clearPuzzle(),buildPuzzle(grid.classList[1]),e.preventDefault()}));const generateGrid=function(e){let t=e.split("x"),l=parseInt(t.shift()),r=parseInt(t.shift());grid.innerHTML="",grid.className="grid",grid.classList.add(e),grid.style.width=3*l+.5+"rem",grid.style.gridTemplateColumns=`repeat(${l}, 3rem)`,grid.style.gridTemplateRows=`repeat(${r}, 3rem)`;for(var n=0;n<l*r;n++)grid.innerHTML+="<div></div>";document.querySelector("#grid").style.display="flex",document.querySelector("#generate-button-wrapper").style.display="flex"},buildPuzzle=function(e){const t=Array.from(document.querySelectorAll("#grid .grid div"));let l=e.split("x"),r=parseInt(l.shift()),n=parseInt(l.shift()),i=r,s=[];for(let e=0;e<n;e++)s[e]=[];let o=[];for(let e=0;e<r;e++)o[e]=[];for(let e=0;e<t.length;e++){let l=Math.floor(e/i);s[l][e-l*i]=t[e].classList.contains("fill"),o[e-l*i][l]=t[e].classList.contains("fill")}let c=buildClues(s,o);const a=document.createElement("div");a.classList.add("clue");var d=grid.cloneNode(!0);d.removeAttribute("id"),d.style.gridColumn="2 / span "+(parseInt(r)+2),d.style.gridRow="2 / span "+(n+2),a.style.gridTemplateColumns=`auto .25rem repeat(${r}, 3rem) .25rem`,a.style.gridTemplateRows=`auto .25rem repeat(${n}, 3rem) .25rem`,a.innerHTML=c,a.appendChild(d),document.querySelector("#clue-grid").append(a),modal.querySelector("h2").innerText=`Puzzle (${e})`,modal.classList.add("open")},clearGrid=function(){document.querySelector("#grid").style.display="none",document.querySelector("#generate-button-wrapper").style.display="none",document.querySelector("#grid .grid").innerHTML=""},clearPuzzle=function(){modal.classList.remove("open"),document.querySelector("#clue-grid").innerHTML=""},buildClues=function(e,t){let l="";for(let t=0;t<e.length;t++)l+=`<span class="row" style="grid-column: 1; grid-row: ${t+3};">`+calculateClues(e,t)+"</span>";for(let e=0;e<t.length;e++)l+=`<span class="col" style="grid-column: ${e+3}; grid-row: 1;">`+calculateClues(t,e)+"</span>";return l},calculateClues=function(e,t){let l="",r=0,n=[];for(let t=0;t<e.length;t++)n[t]=[];for(let i=0;i<e[t].length;i++)e[t][i]?r++:r>0&&(n[t].push(r),l+=`<span>${r}</span>`,r=0),i===e[t].length-1&&r>0&&(n[t].push(r),l+=`<span>${r}</span>`,r=0);return 0===n[t].length&&(l+=`<span>${r}</span>`),l};grid.addEventListener("click",(function(e){e.target.classList.toggle("fill")})),modal.addEventListener("click",(function(e){})),close.addEventListener("click",clearPuzzle),window.addEventListener("keyup",(function(e){"Escape"===e.key&&modal.classList.contains("open")&&clearPuzzle()}));