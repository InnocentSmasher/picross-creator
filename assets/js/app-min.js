const drawGridWrapper=document.querySelector("#draw-grid"),drawGrid=drawGridWrapper.querySelector(".grid");let blankGrid;const modal=document.querySelector(".modal__outer"),clueGrid=modal.querySelector("#clue-grid"),solutionGrid=modal.querySelector("#solution-grid"),generatePuzzleBtn=document.querySelector("#generate-puzzle"),generateCluesBtn=document.querySelector("#generate-clues"),solutionBtn=modal.querySelector("#view-solution"),printBtn=modal.querySelector("#print-puzzle"),closeBtn=modal.querySelector("#close");function generateBlankPuzzle(){const e=document.querySelectorAll(".intro input"),r=document.querySelector("#puzzle-width").value,t=document.querySelector("#puzzle-height").value;verifyInput(r)&&verifyInput(t)?(e.forEach((function(e){e.classList.contains("error")&&e.classList.remove("error")})),clearAllGrids(),generateBlankGrid(r,t)):e.forEach((function(e){e.classList.contains("error")||verifyInput(e.value)?e.classList.contains("error")&&verifyInput(e.value)&&e.classList.remove("error"):e.classList.add("error")}))}function generateBlankGrid(e,r){drawGrid.innerHTML="",drawGrid.className="grid",drawGrid.style.width=3*e+.5+"rem",drawGrid.style.gridTemplateColumns=`repeat(${e}, 3rem)`,drawGrid.style.gridTemplateRows=`repeat(${r}, 3rem)`,drawGrid.setAttribute("data-columns",e),drawGrid.setAttribute("data-rows",r);for(let t=0;t<e*r;t++)drawGrid.innerHTML+="<div></div>";blankGrid=drawGrid.cloneNode(!0),drawGridWrapper.style.display="flex",document.querySelector("#generate-button-wrapper").style.display="flex"}generatePuzzleBtn.addEventListener("click",generateBlankPuzzle),generateCluesBtn.addEventListener("click",(function(e){clearClueGrid(),buildClueGrid(getGridColumns(),getGridRows())}));const buildClueGrid=function(e,r){const t=Array.from(drawGrid.querySelectorAll("div")),n=e;let l=Array.from(Array(r),()=>Array(e)),i=Array.from(Array(e),()=>Array(r));for(let e=0;e<t.length;e++){let r=Math.floor(e/n);l[r][e-r*n]=t[e].classList.contains("fill"),i[e-r*n][r]=t[e].classList.contains("fill")}let o=buildClues(l,i);const a=document.createElement("div");a.classList.add("clue"),blankGrid.style.gridColumn="2 / span "+(e+2),blankGrid.style.gridRow="2 / span "+(r+2),a.style.gridTemplateColumns=`auto .25rem repeat(${e}, 3rem) .25rem`,a.style.gridTemplateRows=`auto .25rem repeat(${r}, 3rem) .25rem`,a.innerHTML=o,a.appendChild(blankGrid),modal.querySelector("h2").innerText=`Puzzle (${e}x${r})`,clueGrid.append(a),solutionGrid.append(drawGrid.cloneNode(!0)),openModal()};function clearAllGrids(){clearGrid(),clearClueGrid()}const clearGrid=function(){drawGridWrapper.style.display="none",document.querySelector("#generate-button-wrapper").style.display="none",drawGrid.innerHTML=""},clearClueGrid=function(){clueGrid.innerHTML=""},buildClues=function(e,r){let t="";for(let r=0;r<e.length;r++)t+=`<span class="row" style="grid-column: 1; grid-row: ${r+3};">`+calculateClues(e,r)+"</span>";for(let e=0;e<r.length;e++)t+=`<span class="col" style="grid-column: ${e+3}; grid-row: 1;">`+calculateClues(r,e)+"</span>";return t};function calculateClues(e,r){let t="",n=0;for(let l=0;l<e[r].length;l++)e[r][l]?n++:n>0&&(t+=`<span>${n}</span>`,n=0),l===e[r].length-1&&n>0&&(t+=`<span>${n}</span>`);return""===t&&(t+="<span>0</span>"),t}function getGridColumns(){return parseInt(drawGrid.getAttribute("data-columns"))}function getGridRows(){return parseInt(drawGrid.getAttribute("data-rows"))}function closeModal(){modal.classList.contains("open")?(modal.classList.remove("open"),printBtn.removeEventListener("click",printPuzzle),closeBtn.removeEventListener("click",closeModal),window.removeEventListener("keyup",handleKeyUp),solutionBtn.removeEventListener("click",toggleSolution)):console.info("Already closed.")}function openModal(){modal.classList.contains("open")?console.info("Already open."):(solutionGrid.classList.contains("hide")||solutionGrid.classList.add("hide"),modal.classList.add("open"),printBtn.addEventListener("click",printPuzzle),closeBtn.addEventListener("click",closeModal),window.addEventListener("keyup",handleKeyUp),solutionBtn.addEventListener("click",toggleSolution))}function handleKeyUp(e){if("Escape"===e.key)return closeModal()}function printPuzzle(){window.print()}function toggleSolution(){solutionGrid.classList.contains("hide")?("Hide Solution"!==solutionBtn.innerText&&(solutionBtn.innerText="Hide Solution"),solutionGrid.classList.remove("hide"),clueGrid.classList.add("hide")):("View Solution"!==solutionBtn.innerText&&(solutionBtn.innerText="View Solution"),solutionGrid.classList.add("hide"),clueGrid.classList.remove("hide"))}function verifyInput(e){return(e=parseInt(e))>0&&e<=25}drawGrid.addEventListener("click",(function(e){e.target.classList.toggle("fill")}));