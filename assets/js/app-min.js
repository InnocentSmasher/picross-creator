const drawGridWrapper=document.querySelector("#draw-grid"),drawGrid=drawGridWrapper.querySelector(".grid");let clueSubGrid,solutionSubGrid;const modal=document.querySelector(".modal__outer"),clueGrid=modal.querySelector("#clue-grid"),solutionGrid=modal.querySelector("#solution-grid"),generatePuzzleBtn=document.querySelector("#generate-puzzle"),generateCluesBtn=document.querySelector("#generate-clues"),solutionBtn=modal.querySelector("#view-solution"),printBtn=modal.querySelector("#print-puzzle"),closeBtn=modal.querySelector("#close");function generateBlankPuzzle(){const e=document.querySelectorAll(".intro input"),r=document.querySelector("#puzzle-width").value,t=document.querySelector("#puzzle-height").value;verifyInput(r)&&verifyInput(t)?(e.forEach((function(e){e.classList.remove("error")})),clearAllGrids(),generateDrawGrid(r,t),generateClueSubGrid(),initializeDrawGrid()):e.forEach((function(e){verifyInput(e.value)?e.classList.remove("error"):e.classList.add("error")}))}function generateDrawGrid(e,r){drawGrid.classList.add("grid"),drawGrid.style.width=3*e+.5+"rem",drawGrid.style.gridTemplateColumns=`repeat(${e}, 3rem)`,drawGrid.style.gridTemplateRows=`repeat(${r}, 3rem)`,drawGrid.setAttribute("data-columns",e),drawGrid.setAttribute("data-rows",r);let t=[];for(let n=0;n<e*r;n++)t.push("<div></div>");drawGrid.innerHTML=t.join("")}function initializeDrawGrid(){drawGridWrapper.style.display="flex",document.querySelector("#generate-button-wrapper").style.display="flex",drawGrid.addEventListener("click",(function(e){e.target!==drawGrid&&e.target.classList.toggle("fill")}))}function generateClueSubGrid(){clueSubGrid=drawGrid.cloneNode(!0)}function generateSolutionSubGrid(){solutionSubGrid=drawGrid.cloneNode(!0)}function generateClueHTML(e,r){const t=Array.from(drawGrid.querySelectorAll("div")),n=e;let l=Array.from(Array(r),(()=>Array(e))),i=Array.from(Array(e),(()=>Array(r)));for(let e=0;e<t.length;e++){let r=Math.floor(e/n);l[r][e-r*n]=t[e].classList.contains("fill"),i[e-r*n][r]=t[e].classList.contains("fill")}const o=document.createElement("div");o.classList.add("clue"),o.style.gridTemplateColumns=`auto .25rem repeat(${e}, 3rem) .25rem`,o.style.gridTemplateRows=`auto .25rem repeat(${r}, 3rem) .25rem`,o.innerHTML=buildClues(l,i),modal.querySelector("h2").textContent=`Puzzle (${e}x${r})`,clueSubGrid.style.gridColumn="2 / span "+(e+2),clueSubGrid.style.gridRow="2 / span "+(r+2),placeSubGrids(e,r),buildClueGrid(o),buildSolutionGrid(o.cloneNode(!0),e,r),openModal()}function placeSubGrids(e,r){clueSubGrid.style.gridColumn="2 / span "+(e+2),clueSubGrid.style.gridRow="2 / span "+(r+2),solutionSubGrid.style.gridColumn="2 / span "+(e+2),solutionSubGrid.style.gridRow="2 / span "+(r+2)}function buildClueGrid(e){e.appendChild(clueSubGrid),clueGrid.append(e)}function buildSolutionGrid(e,r,t){solutionGrid.append(e),solutionGrid.querySelector(".clue").append(solutionSubGrid)}function clearAllGrids(){clearGrid(),clearClueGrid(),clearSolutionGrid()}generatePuzzleBtn.addEventListener("click",generateBlankPuzzle),generateCluesBtn.addEventListener("click",(function(e){clearClueGrid(),generateSolutionSubGrid(),generateClueHTML(getGridColumns(),getGridRows())}));const clearGrid=function(){drawGridWrapper.style.display="none",document.querySelector("#generate-button-wrapper").style.display="none",drawGrid.innerHTML=""},clearClueGrid=function(){clueGrid.innerHTML=""};function clearSolutionGrid(){solutionGrid.innerHTML=""}const buildClues=function(e,r){let t="";for(let r=0;r<e.length;r++)t+=`<span class="row" style="grid-column: 1; grid-row: ${r+3};">`+calculateClues(e,r)+"</span>";for(let e=0;e<r.length;e++)t+=`<span class="col" style="grid-column: ${e+3}; grid-row: 1;">`+calculateClues(r,e)+"</span>";return t};function calculateClues(e,r){let t="",n=0;for(let l=0;l<e[r].length;l++)e[r][l]?n++:n>0&&(t+=`<span>${n}</span>`,n=0),l===e[r].length-1&&n>0&&(t+=`<span>${n}</span>`);return""===t&&(t+="<span>0</span>"),t}function getGridColumns(){return parseInt(drawGrid.getAttribute("data-columns"))}function getGridRows(){return parseInt(drawGrid.getAttribute("data-rows"))}function openModal(){modal.classList.contains("open")?console.info("Already open."):(solutionGrid.classList.add("hide"),printBtn.addEventListener("click",printPuzzle),closeBtn.addEventListener("click",closeModal),window.addEventListener("keyup",handleKeyUp),solutionBtn.addEventListener("click",toggleSolution),modal.classList.add("open"))}function closeModal(){modal.classList.contains("open")?(modal.classList.remove("open"),printBtn.removeEventListener("click",printPuzzle),closeBtn.removeEventListener("click",closeModal),window.removeEventListener("keyup",handleKeyUp),solutionBtn.removeEventListener("click",toggleSolution)):console.info("Already closed.")}function handleKeyUp(e){if("Escape"===e.key)return closeModal()}function printPuzzle(){window.print()}function toggleSolution(){solutionGrid.classList.contains("hide")?solutionBtn.textContent="Hide Solution":solutionBtn.textContent="View Solution",solutionGrid.classList.toggle("hide"),clueGrid.classList.toggle("hide")}function verifyInput(e){return parseInt(e)>0&&parseInt(e)<=25}